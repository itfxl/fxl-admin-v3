import{o as l,c as p,r as i,a as Y,M as N,d as D,b as f,e as Z,f as ee,g as v,h as m,i as a,w as u,u as _,I as F,j as R,k as P,p as te,l as ne,n as se,t as k,m as oe,q as I,F as L,s as H,v as re,x as ae,y as ue,z as ie,A as ce,B as le,C as de,D as _e,E as me,G as pe}from"./vendor.7f30f3e6.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();const y=(e,n)=>{const t=e.__vccOpts||e;for(const[r,s]of n)t[r]=s;return t},fe={};function he(e,n){const t=i("router-view");return l(),p(t)}const ve=y(fe,[["render",he]]),ge="modulepreload",Ee=function(e){return"/fxl-admin-v3/"+e},V={},$=function(n,t,r){return!t||t.length===0?n():Promise.all(t.map(s=>{if(s=Ee(s),s in V)return;V[s]=!0;const o=s.endsWith(".css"),c=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${c}`))return;const d=document.createElement("link");if(d.rel=o?"stylesheet":ge,o||(d.as="script",d.crossOrigin=""),d.href=s,document.head.appendChild(d),o)return new Promise((E,h)=>{d.addEventListener("load",E),d.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>n())},ye="https://mock.apifox.cn/m1/1504786-0-default",g=Y.create({baseURL:ye,timeout:6e4}),be="Bearer ";g.interceptors.request.use(e=>{const n=b();return n.token&&e.headers&&(e.headers.Authorization=be+n.token),e});g.interceptors.response.use(e=>e.data,async e=>{var t,r,s;const n=(t=e.response)==null?void 0:t.data;return n&&await N.error(n.message),(((r=e.response)==null?void 0:r.status)===401||((s=e.response)==null?void 0:s.status)===403)&&await b().logout(),Promise.reject(e)});const Se=e=>g.post("/tokens",e),Be={createToken:Se},we=()=>g.get("/users/me"),Fe=e=>g.get("/users",{params:e}),Re=e=>g.post("/users",e),Ae=(e,n)=>g.post(`/user/${e}`,n),ke={me:we,list:Fe,create:Re,edit:Ae},q=(e,n)=>e.filter(t=>(t.children&&(t.children=q(t.children,n)),!t.meta||t.meta&&(!t.meta.permission||t.meta.permission&&n.includes(t.meta.permission)))),M=e=>{const n=[];return e.forEach(t=>{t.children&&n.push(...M(t.children)),t.name&&n.push(t.name)}),n},O=D("permission",{state:()=>({routes:[]}),persist:!0,actions:{generateRoutes(e,n=!1){this.routes=n?U:q(U,e)}},getters:{menuRoutes(){var e;return(e=this.routes.find(n=>n.name===G))==null?void 0:e.children},permissionRouteNamesList(){return this.routes?M(this.routes):[]}}}),x=D("user",{state:()=>({currentUser:null}),persist:!0,actions:{async fetchCurrentUser(){this.currentUser=await ke.me(),console.log(this.currentUser),O().generateRoutes(this.currentUser.permissions)}}}),b=D("app",{state:()=>({token:"",menuCollapse:!1}),persist:!0,actions:{async login(e){this.token=await Be.createToken(e)},async logout(){const e=x();this.token="",e.$reset()}}}),xe=e=>(te("data-v-02deef29"),e=e(),ne(),e),Ce={class:"login-container"},$e={class:"content"},Le=xe(()=>m("h1",null,"FxlAdmin",-1)),Ue=R("\u767B\u5F55 "),De=f({__name:"index",setup(e){const n={username:[{required:!0,message:"\u8BF7\u586B\u5199\u7528\u6237\u540D"}],password:[{required:!0,message:"\u8BF7\u586B\u5199\u5BC6\u7801"}]},t=Z({username:"",password:""}),r=b(),s=x(),o=ee(!1),c=P(),d=async({validateResult:E})=>{if(E===!0){o.value=!0;try{await r.login(t),await s.fetchCurrentUser(),await N.success("\u767B\u5F55\u6210\u529F"),await c.push({name:"dashboard"})}finally{o.value=!1}}};return(E,h)=>{const A=i("t-input"),B=i("t-form-item"),J=i("t-button"),Q=i("t-form"),X=i("t-card");return l(),v("div",Ce,[m("div",$e,[a(X,null,{default:u(()=>[Le,a(Q,{ref:"form",data:t,rules:n,class:"login-form",colon:!0,"label-width":0,onSubmit:d},{default:u(()=>[a(B,{name:"username"},{default:u(()=>[a(A,{modelValue:t.username,"onUpdate:modelValue":h[0]||(h[0]=C=>t.username=C),clearable:"",placeholder:"\u8D26\u53F7\uFF1Aadmin"},{"prefix-icon":u(()=>[a(_(F),{name:"desktop"})]),_:1},8,["modelValue"])]),_:1}),a(B,{name:"password"},{default:u(()=>[a(A,{modelValue:t.password,"onUpdate:modelValue":h[1]||(h[1]=C=>t.password=C),type:"password",clearable:"",placeholder:"\u5BC6\u7801\uFF1Aadmin123"},{"prefix-icon":u(()=>[a(_(F),{name:"lock-on"})]),_:1},8,["modelValue"])]),_:1}),a(B,{style:{"padding-top":"8px"}},{default:u(()=>[a(J,{theme:"primary",type:"submit",block:"",loading:o.value},{default:u(()=>[Ue]),_:1},8,["loading"])]),_:1})]),_:1},8,["data"])]),_:1})])])}}});const Oe=y(De,[["__scopeId","data-v-02deef29"]]),Ie=f({__name:"CollapseButton",props:{collapse:{type:Boolean,required:!0}},emits:["update:collapse"],setup(e){return(n,t)=>(l(),v("div",{class:se(["collapse-button",{collapse:!e.collapse}]),onClick:t[0]||(t[0]=r=>n.$emit("update:collapse",!e.collapse))},null,2))}});const Ve=y(Ie,[["__scopeId","data-v-bdf185ec"]]),Te={class:"operation-area"},Ne=f({__name:"header",setup(e){const n=x(),t=b(),r=P(),s=oe(),o=async({value:c})=>{switch(c){case"logout":await t.logout(),await r.push({name:"login",params:{redirect:s.fullPath}});break}};return(c,d)=>{const E=i("t-button"),h=i("t-dropdown"),A=i("t-header");return l(),p(A,{class:"header"},{default:u(()=>[a(Ve,{collapse:_(t).menuCollapse,"onUpdate:collapse":d[0]||(d[0]=B=>_(t).menuCollapse=B)},null,8,["collapse"]),m("div",Te,[a(h,{options:[{content:"\u9000\u51FA\u767B\u5F55",value:"logout"}],"min-column-width":112,onClick:o},{default:u(()=>[a(E,{variant:"text"},{icon:u(()=>[a(_(F),{name:"user"})]),default:u(()=>[R(" "+k(_(n).currentUser&&_(n).currentUser.nickname),1)]),_:1})]),_:1})])]),_:1})}}});const Pe=y(Ne,[["__scopeId","data-v-128f253b"]]),He=f({__name:"SidebarItem",props:{item:{type:Object,default:null}},setup(e){return(n,t)=>{const r=i("t-menu-item"),s=i("sidebar-item",!0),o=i("t-submenu");return l(),v(L,null,[e.item&&!e.item.children?(l(),p(r,{key:0,value:e.item.name,to:{name:e.item.name}},{icon:u(()=>[a(_(F),{name:e.item.meta.icon},null,8,["name"])]),default:u(()=>[R(" "+k(e.item.meta.title),1)]),_:1},8,["value","to"])):I("",!0),e.item&&e.item.children?(l(),p(o,{key:1,value:e.item.name,title:e.item.meta.title},{icon:u(()=>[a(_(F),{name:e.item.meta.icon},null,8,["name"])]),default:u(()=>[(l(!0),v(L,null,H(e.item.children,c=>(l(),p(s,{key:c.name,item:c},null,8,["item"]))),128))]),_:1},8,["value","title"])):I("",!0)],64)}}}),qe=f({__name:"sidebar",setup(e){const n=b(),t=O();return(r,s)=>{const o=i("t-menu"),c=i("t-aside");return l(),p(c,{width:_(n).menuCollapse?"64px":"232px"},{default:u(()=>[a(o,{collapsed:_(n).menuCollapse,defaultValue:r.$route.name},{default:u(()=>[(l(!0),v(L,null,H(_(t).menuRoutes,d=>(l(),p(He,{key:d.name,item:d},null,8,["item"]))),128))]),_:1},8,["collapsed","defaultValue"])]),_:1},8,["width"])}}}),Me=R("Copyright @ 2021-2022 FxlAdmin."),je=f({__name:"layout",setup(e){return(n,t)=>{const r=i("router-view"),s=i("t-content"),o=i("t-footer"),c=i("t-layout");return l(),v("div",null,[a(c,{class:"main-layout"},{default:u(()=>[a(qe),a(c,null,{default:u(()=>[a(Pe),a(s,{class:"content-layout"},{default:u(()=>[a(r)]),_:1}),a(o,{style:{"text-align":"center"}},{default:u(()=>[Me]),_:1})]),_:1})]),_:1})])}}});const ze=y(je,[["__scopeId","data-v-674ffb33"]]),j="/fxl-admin-v3/assets/not-found.c2e9c2e1.png",Ge={class:"main"},We={class:"content"},Ke=m("img",{src:j},null,-1),Je={class:"info"},Qe={class:"title"},Xe={class:"description"},Ye=R("\u8FD4\u56DE\u9996\u9875"),z=f({__name:"ErrorPage",props:{title:{default:"\u672A\u77E5\u9519\u8BEF"},description:{default:"\u6682\u65F6\u65E0\u6CD5\u627E\u5230\u9519\u8BEF\u539F\u56E0"}},setup(e){return(n,t)=>{const r=i("t-button");return l(),v("div",Ge,[m("div",We,[re(n.$slots,"image",{},()=>[Ke]),m("div",Je,[m("div",Qe,k(e.title),1),m("div",Xe,k(e.description),1),a(r,{onClick:t[0]||(t[0]=s=>n.$router.replace({path:"/"}))},{default:u(()=>[Ye]),_:1})])])])}}});const Ze=m("img",{src:j},null,-1),et=f({__name:"not-found",setup(e){return(n,t)=>(l(),p(z,{title:"404\u65E0\u6CD5\u627E\u5230\u8BE5\u9875\u9762",description:"\u62B1\u6B49\u60A8\u8BBF\u95EE\u7684\u9875\u9762\u4E0D\u5B58\u5728"},{image:u(()=>[Ze]),_:1}))}}),tt="/fxl-admin-v3/assets/not-allowed.95b00d4e.png",nt=m("img",{src:tt},null,-1),st=f({__name:"not-allowed",setup(e){return(n,t)=>(l(),p(z,{title:"403\u65E0\u6743\u8BBF\u95EE",description:"\u60A8\u5F53\u524D\u65E0\u6743\u8BBF\u95EE\u8BE5\u9875\u9762\uFF0C\u82E5\u6709\u7591\u95EE\u8BF7\u8DDF\u7F51\u7AD9\u7BA1\u7406\u5458\u8054\u7CFB"},{image:u(()=>[nt]),_:1}))}}),ot={};function rt(e,n){const t=i("router-view");return l(),p(t)}const at=y(ot,[["render",rt]]);var w=(e=>(e.DASHBOARD="dashboard",e.USER="user",e.USER_LIST="user:list",e.USER_LIST_CREATE="user:list:create",e.USER_LIST_EDIT="user:list:edit",e.USER_ROLES="user:roles",e.USER_ROLES_CREATE="user:roles:create",e.USER_ROLES_EDIT="user:roles:edit",e))(w||{});const lt=[{label:"\u63A7\u5236\u53F0",value:"dashboard"},{label:"\u7528\u6237",value:"user",children:[{label:"\u7528\u6237\u7BA1\u7406",value:"user:list",children:[{label:"\u7528\u6237\u521B\u5EFA",value:"user:list:create"},{label:"\u7528\u6237\u7F16\u8F91",value:"user:list:edit"}]},{label:"\u89D2\u8272\u7BA1\u7406",value:"user:roles",children:[{label:"\u89D2\u8272\u521B\u5EFA",value:"user:roles:create"},{label:"\u89D2\u8272\u7F16\u8F91",value:"user:roles:edit"}]}]}],G="menuRoot",U=[{path:"/",name:G,component:ze,redirect:"dashboard",children:[{name:"dashboard",path:"dashboard",component:()=>$(()=>import("./index.60a4bcd3.js"),["assets/index.60a4bcd3.js","assets/index.40cc8d41.css","assets/vendor.7f30f3e6.js","assets/vendor.2533a568.css"]),meta:{permission:w.DASHBOARD,title:"\u63A7\u5236\u53F0",icon:"dashboard"}},{name:"user",path:"user",component:at,meta:{title:"\u7528\u6237",icon:"usergroup",permission:w.USER},redirect:{name:"user-list"},children:[{name:"user-list",path:"list",component:()=>$(()=>import("./index.31ad8509.js"),["assets/index.31ad8509.js","assets/useEditDialog.0170a482.js","assets/vendor.7f30f3e6.js","assets/vendor.2533a568.css"]),meta:{title:"\u7528\u6237\u7BA1\u7406",icon:"user",permission:w.USER_LIST}},{name:"role-list",path:"roles",component:()=>$(()=>import("./roles.a50e8690.js"),["assets/roles.a50e8690.js","assets/useEditDialog.0170a482.js","assets/vendor.7f30f3e6.js","assets/vendor.2533a568.css"]),meta:{title:"\u89D2\u8272\u7BA1\u7406",permission:w.USER_ROLES,icon:"secured"}}]}]},{path:"/login",name:"login",component:Oe},{path:"/403",name:"not-allowed",component:st},{path:"/:pathMatch(.*)*",name:"not-found",component:et}],W=ae({history:ue(),strict:!0,routes:U,scrollBehavior:()=>({left:0,top:0})}),T=["login","not-found","not-allowed"];W.beforeEach((e,n,t)=>{const r=b();if(r.token||(T.indexOf(e.name)!==-1?t():t(`/login?redirect=${e.path}`)),r.token&&e.path==="/login"&&t({name:"dashboard"}),e.name){const o=!O().permissionRouteNamesList.includes(e.name);r.token&&o&&T.indexOf(e.name)!==-1&&t({name:"not-allowed"})}t()});const ut=e=>{var n;return((n=x().currentUser)==null?void 0:n.permissions.indexOf(e))===-1},it={mounted(e,{value:n}){var t;ut(n)&&((t=e.parentNode)==null||t.removeChild(e))}},K=ie();K.use(ce);const S=le(ve);S.use(W);S.use(de);S.use(K);S.use(_e,{echarts:me,h:pe});S.directive("permission",it);S.mount("#app");export{w as P,y as _,g as i,lt as p,ke as u};
